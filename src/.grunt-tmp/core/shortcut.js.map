{"version":3,"sources":["shortcut.js"],"names":["Zemit","app","run","$rs","$zm","$history","$hook","$modal","$session","add","settings","get","$zemit","on","event","isInInput","angular","element","target","is","resetFocus","find","focus","altKey","which","metaKey","action","widget","removeAllSelected","$digest","preventDefault","ctrlKey","duplicate","content","clear","oldContext","context","$apply","redo","undo","open"],"mappings":"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","file":"shortcut.js","sourcesContent":["/**\n * Zemit Shortcuts\n * @author: <contact@dannycoulombe.com>\n * Creation date: 2018-01-12\n * \n * Listen to keydown events\n */\n(function() {\n\tZemit.app.run(['$rootScope', '$zm', '$history', '$hook', '$modal', '$session', function($rs, $zm, $history, $hook, $modal, $session) {\n\t\t\n\t\t$hook.add('onReady', () => {\n\t\t\t\n\t\t\tvar settings = $session.get('settings');\n\t\t\t\n\t\t\t$rs.$zemit.on('keydown', function(event) {\n\t\t\t\t\t\t\t\t\n\t\t\t\tlet isInInput = (angular.element(event.target).is('input')\n\t\t\t\t\t|| angular.element(event.target).is('textarea')\n\t\t\t\t\t|| angular.element(event.target).is('[contenteditable]')\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t// Hack: If focus is in an input while switching context,\n\t\t\t\t// shortcuts stops to work. We need to leave the input first\n\t\t\t\t// using this trick.\n\t\t\t\tlet resetFocus = () => {\n\t\t\t\t\t$rs.$zemit.find('[tabindex]:eq(0)').focus();\n\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\tif(!event.altKey && isInInput) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tswitch(event.which) {\n\t\t\t\t\tcase 8: // Delete MAC\n\t\t\t\t\t\tif(event.metaKey) {\n\t\t\t\t\t\t\t$zm.action($zm.widget.removeAllSelected);\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 9: // Tab\n\t\t\t\t\t\n\t\t\t\t\t\t// TODO: Loop through widgets if one selected. Otherwise\n\t\t\t\t\t\t// do normal behaviour\n\t\t\t\t\t\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 13: // Enter\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 27: // ESC\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 46: // Delete PC\n\t\t\t\t\t\t$zm.action($zm.widget.removeAllSelected);\n\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 68: // D\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\t$zm.action($zm.widget.duplicate);\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// if(event.altKey) {\n\t\t\t\t\t\t// \tsettings.context = 'design';\n\t\t\t\t\t\t// \t$rs.$digest();\n\t\t\t\t\t\t// \tevent.preventDefault();\n\t\t\t\t\t\t// }\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 69: // E\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\t// TODO: DEFAULT ACTION\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 75: // K\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\t$zm.content.clear();\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 78: // N\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\t// TODO: NEW SEGMENT\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 80: // P\n\t\t\t\t\t\tif(event.altKey) {\n\t\t\t\t\t\t\tresetFocus();\n\t\t\t\t\t\t\tlet oldContext = settings.context;\n\t\t\t\t\t\t\tsettings.context = 'preview';\n\t\t\t\t\t\t\t$hook.run('onContextChange', 'preview', oldContext);\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 83: // S\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t// TODO: SAVE CONTENT\n\t\t\t\t\t\t\t$rs.$apply();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(event.altKey) {\n\t\t\t\t\t\t\tresetFocus();\n\t\t\t\t\t\t\tlet oldContext = settings.context;\n\t\t\t\t\t\t\tsettings.context = 'structure';\n\t\t\t\t\t\t\t$hook.run('onContextChange', 'structure', oldContext);\n\t\t\t\t\t\t\t$rs.$digest();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 89: // Y\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t$history.redo();\n\t\t\t\t\t\t\t$rs.$apply();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 90: // Z\n\t\t\t\t\t\tif(event.ctrlKey || event.metaKey) {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t$history.undo();\n\t\t\t\t\t\t\t$rs.$apply();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 112: // F1\n\t\t\t\t\t\t$modal.open('doc')\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}]);\n})();"]}