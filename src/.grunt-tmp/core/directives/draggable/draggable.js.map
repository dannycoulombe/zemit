{"version":3,"sources":["draggable.js"],"names":["Zemit","app","run","$debug","$hook","$i18n","add","init","get","directive","$device","restrict","scope","options","item","link","$s","$e","attrs","draggableOptions","holdDuration","manualStart","endOnly","elementRect","top","left","bottom","right","autoScroll","container","onmove","event","interaction","isReady","log","interacting","preventDefault","target","$element","x","parseFloat","getAttribute","dx","y","dy","css","setAttribute","element","document","elementFromPoint","clientX","clientY","angular","trigger","stopPropagation","onend","width","height","removeAttribute","onEnd","remove","onStart","dontRemove","dropState","position","part","widget","$clone","cloneNode","addClass","body","appendChild","offset","draggedItem","copy","pointerIsDown","isTouch","vibrate","onBeforeStart","start","name","interactable","interactObj","interact","origin","draggable","styleCursor","on"],"mappings":"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","file":"draggable.js","sourcesContent":["/**\n * @author <contact@dannycoulombe.com>\n */\n(function() {\n\t\n\t/**\n\t * Draggable initialization\n\t */\n\tZemit.app.run(['$debug', '$hook', '$i18n', function($debug, $hook, $i18n) {\n\t\t$hook.add('onReady', () => $debug.init('draggable', $i18n.get('core.directives.draggable.debugTitle')));\n\t}]);\n\t\n\t/**\n\t * Draggable directive\n\t */\n\tZemit.app.directive('zmDraggable', ['$device', '$debug', function($device, $debug) {\n\t\treturn {\n\t\t\trestrict: 'A',\n\t\t\tscope: {\n\t\t\t\toptions: '=zmDraggable',\n\t\t\t\titem: '=zmDraggableItem'\n\t\t\t},\n\t\t\tlink: function ($s, $e, attrs) {\n\t\t\t\t\n\t\t\t\tvar draggableOptions = {\n\t\t\t\t\tholdDuration: 200,\n\t\t\t\t\tmanualStart: true,\n\t\t\t\t\trestrict: {\n\t\t\t\t\t\tendOnly: true,\n\t\t\t\t\t\telementRect: {\n\t\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\t\tbottom: 1,\n\t\t\t\t\t\t\tright: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tautoScroll: {\n\t\t\t\t\t\tcontainer: $s.options.container,\n\t\t\t\t\t},\n\t\t\t\t\tonmove: function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!event.interaction.isReady) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t$debug.log('draggable', 'MOVE', event);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(event.interaction.interacting()) {\n\t\t\t\t\t    \tevent.preventDefault();\n\t\t\t\t\t    }\n\t\t\t\t\t    \n\t\t\t\t\t\tvar target = event.interaction.$element[0],\n\t\t\t\t\t\t\t// keep the dragged position in the data-x/data-y attributes\n\t\t\t\t\t\t\tx = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\n\t\t\t\t\t\t\ty = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\n\t\t\t\t\t\tvar $element = event.interaction.$element;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// translate the element\n\t\t\t\t\t\t$element.css({\n\t\t\t\t\t\t\ttop: y + 'px',\n\t\t\t\t\t\t\tleft: x + 'px'\n\t\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t\t// Update the position attributes\n\t\t\t\t\t\ttarget.setAttribute('data-x', x);\n\t\t\t\t\t\ttarget.setAttribute('data-y', y);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar element = document.elementFromPoint(\n\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\tevent.clientY\n\t\t\t\t\t\t);\n\t\t\t\t\t\t\n\t\t\t\t\t\tangular.element(element).trigger('dragHoverTouch', {\n\t\t\t\t\t\t\tx: event.clientX,\n\t\t\t\t\t\t\ty: event.clientY\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t},\n\t\t\t\t\tonend: function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t$debug.log('draggable', 'END', event);\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar target = event.interaction.$element[0];\n\t\t\t\t\t\tvar $element = event.interaction.$element;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Reset widget position\n\t\t\t\t\t\t$element.css({\n\t\t\t\t\t\t\ttop: '',\n\t\t\t\t\t\t\tleft: '',\n\t\t\t\t\t\t\twidth: '',\n\t\t\t\t\t\t\theight: ''\n\t\t\t\t\t\t});\n\t\t\t\t\t\ttarget.removeAttribute('data-x');\n\t\t\t\t\t\ttarget.removeAttribute('data-y');\n\t\t\t\t\t\t\n\t\t\t\t\t\t$s.options.onEnd && $s.options.onEnd();\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.interaction.$element.remove();\n\t\t\t\t\t\t$element.remove();\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tvar onStart = function(event) {\n\t\t\t\t\t\n\t\t\t\t\t$debug.log('draggable', 'START', event);\n\t\t\t\t\t\n\t\t\t\t\tevent.interaction.dontRemove = true;\n\t\t\t\t\tevent.interaction.dropState = {\n\t\t\t\t\t\tposition: null,\n\t\t\t\t\t\tpart: null,\n\t\t\t\t\t\twidget: null\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tvar $clone = angular.element($e[0].cloneNode(true));\n\t\t\t\t\t$clone.addClass('zm-draggable-dragged-item');\n\t\t\t\t\tdocument.body.appendChild($clone[0]);\n\t\t\t\t\tevent.interaction.$element = $clone;\n\t\t\t\t\t\n\t\t\t\t\t// Set dragged widget\n\t\t\t\t\t$clone[0].setAttribute('data-y', $e.offset().top);\n\t\t\t\t\t$clone[0].setAttribute('data-x', $e.offset().left);\n\t\t\t\t\t$clone.css({\n\t\t\t\t\t\t'top': $e.offset().top + 'px',\n\t\t\t\t\t\t'left': $e.offset().left + 'px',\n\t\t\t\t\t\t'width': $e.width() + 'px',\n\t\t\t\t\t\t'height': $e.height() + 'px',\n\t\t\t\t\t\t'min-width': 'auto',\n\t\t\t\t\t\t'min-height': 'auto'\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tevent.interaction.draggedItem = angular.copy($s.item);\n\t\t\t\t\tevent.interaction.isReady = true;\n\t\t\t\t\t\n\t\t\t\t\treturn $clone;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Move the element around\n\t\t\t\t */\n\t\t\t\tvar manualStart = function(event) {\n\t\t\t\t\tvar interaction = event.interaction;\n\t\t\t\t\t\t\n\t\t\t\t\tif (interaction.pointerIsDown && !interaction.interacting()) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t$device.isTouch() && $device.vibrate();\n\t\t\t\t\t\tvar $clone = onStart(event);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// If in portrait mode, close all sidebar tabs\n\t\t\t\t\t\t$s.options.onBeforeStart && $s.options.onBeforeStart(event);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$debug.log('draggable', 'MANUAL_START', event);\n\t\t\t\t\t\t\n\t\t\t\t\t\tinteraction.start({\n\t\t\t\t\t\t\tname: 'drag'\n\t\t\t\t\t\t}, event.interactable, $clone[0]);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tvar interactObj = interact($e[0]).origin(\"body\").draggable(draggableOptions).styleCursor(false);\n\t\t\t\t\n\t\t\t\t!$device.isTouch() && interactObj.on('move', manualStart);\n\t\t\t\t$device.isTouch() && interactObj.on('hold', manualStart);\n\t\t\t}\n\t\t};\n\t}]);\n})();"]}