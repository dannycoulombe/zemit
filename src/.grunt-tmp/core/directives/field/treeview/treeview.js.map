{"version":3,"sources":["treeview.js"],"names":["Zemit","app","run","$session","prepare","treeview","directive","$timeout","$filter","restrict","scope","list","options","filterScope","templateUrl","link","$s","$e","attrs","depth","visible","parent","parentList","defaultTemplate","defaultLvlOptions","defaultLvlToolbar","defaultLvlBefore","defaultLvlAfter","settings","get","addCallback","index","key","title","data","childs","splice","$digest","editCallback","node","angular","extend","toggle","nodeSettings","event","viewItems","$target","element","target","$scrollContainer","parents","length","top","offset","animate","scrollTop","filter","nodes","model","value","removeCallback","count","levels","getList"],"mappings":"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","file":"treeview.js","sourcesContent":["/**\n * @author <contact@dannycoulombe.com>\n */\n(function() {\n\t\n\tZemit.app.run(['$session', function($session) {\n\t\t$session.prepare('settings', {\n\t\t\ttreeview: {}\n\t\t});\n\t}]);\n\t\n\t/**\n\t * Switch field\n\t */\n\tZemit.app.directive('zmFieldTreeview', ['$timeout', '$filter', '$session', function($timeout, $filter, $session) {\n\t\treturn {\n\t\t\trestrict: 'E',\n\t\t\tscope: {\n\t\t\t\tlist: '=',\n\t\t\t\toptions: '=',\n\t\t\t\tscope: '=?',\n\t\t\t\tfilterScope: '=?filter'\n\t\t\t},\n\t\t\ttemplateUrl: 'core/directives/field/treeview/treeview.html',\n\t\t\tlink: function ($s, $e, attrs) {\n\t\t\t\t\n\t\t\t\t$s.depth = 0;\n\t\t\t\t$s.visible = true;\n\t\t\t\t$s.parent = $s.list;\n\t\t\t\t$s.parentList = $s.list;\n\t\t\t\t$s.defaultTemplate = 'core/directives/field/treeview/treeview.default.html';\n\t\t\t\t$s.defaultLvlOptions = 'core/directives/field/treeview/treeview.options.html';\n\t\t\t\t$s.defaultLvlToolbar = 'core/directives/field/treeview/treeview.toolbar.html';\n\t\t\t\t$s.defaultLvlBefore = 'core/directives/field/treeview/treeview.before.html';\n\t\t\t\t$s.defaultLvlAfter = 'core/directives/field/treeview/treeview.after.html';\n\t\t\t\t$s.settings = $session.get('settings');\n\t\t\t\t\n\t\t\t\t$s.addCallback = function(list, index) {\n\t\t\t\t\treturn function(key, title, data, childs = []) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tlist.splice(index, 0, {\n\t\t\t\t\t\t\tkey: key,\n\t\t\t\t\t\t\ttitle: title,\n\t\t\t\t\t\t\tdata: data,\n\t\t\t\t\t\t\tchilds: childs\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Open by default\n\t\t\t\t\t\t$s.settings.treeview[key] = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\t$s.$digest();\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$s.editCallback = function(node) {\n\t\t\t\t\treturn function(key, title, data, childs) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tangular.extend(node, {\n\t\t\t\t\t\t\tkey: key || node.key,\n\t\t\t\t\t\t\ttitle: title || node.title,\n\t\t\t\t\t\t\tdata: data || node.data,\n\t\t\t\t\t\t\tchilds: childs || node.childs\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t$s.$digest();\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$s.toggle = function(nodeSettings, node, event) {\n\t\t\t\t\t\n\t\t\t\t\tnodeSettings.viewItems = !nodeSettings.viewItems;\n\t\t\t\t\t\n\t\t\t\t\tlet $target = angular.element(event.target).parent();\n\t\t\t\t\tlet $scrollContainer = $target.parents('.zm-scrollable-y:eq(0)');\n\t\t\t\t\tif($scrollContainer.length === 0) {\n\t\t\t\t\t\t$scrollContainer = angular.element('body');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlet top = ($target.offset().top - $scrollContainer.offset().top);\n\t\t\t\t\t\n\t\t\t\t\t$s.settings.treeview[node.key] = nodeSettings.viewItems;\n\t\t\t\t\t\n\t\t\t\t\t$scrollContainer.animate({\n\t\t\t\t\t\tscrollTop: top\n\t\t\t\t\t}, 250);\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$s.filter = function(nodes) {\n\t\t\t\t\t\n\t\t\t\t\treturn $filter('search')(nodes, (model) => {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tvalue: model.title,\n\t\t\t\t\t\t\tchilds: model.childs\n\t\t\t\t\t\t};\n\t\t\t\t\t}, $s.filterScope, true);\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$s.removeCallback = function(parentList, index) {\n\t\t\t\t\treturn function() {\n\t\t\t\t\t\tparentList.splice(index, 1);\n\t\t\t\t\t\t$s.$digest();\n\t\t\t\t\t};\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t$s.count = function(node, parent, depth) {\n\t\t\t\t\treturn $s.options.levels[depth].getList(node).length;\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}]);\n})();"]}