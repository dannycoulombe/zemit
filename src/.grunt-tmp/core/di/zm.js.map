{"version":3,"sources":["zm.js"],"names":["Zemit","app","factory","$history","$file","$session","$modal","$hook","$i18n","add","content","get","set","baseScope","version","defaultContainer","childs","defaultWidget","styles","setBaseScope","scope","getBaseScope","session","flushHistory","flush","flushAll","widget","ENCODE","DECODE","parse","data","parser","angular","forEach","d","k","encodeURIComponent","decodeURIComponent","Object","Array","cleaned","fromJson","toJson","copy","clear","length","dialog","backdrop","title","buttons","label","warning","callback","event","modal","containerWidget","action","undefined","close","default","load","Promise","resolve","reject","value","findByToken","token","container","found","forEachChilds","params","transaction","apply","total","totalSelected","hoveredWidget","allSelectedSameType","updateWidgetStates","areAllSelectedSameType","countSelected","count","forEachSelected","getScope","isSelected","lastType","allSameType","type","canEdit","hasDefaultAction","configs","defaultAction","Function","edit","unselectAll","setSelected","parent","hovered","keys","getAll","isset","i","clearAndTraverse","hooks","unset","push","forEachParents","unshift","reverse","splice","drag","enabled","originalWidget","isAlone","setCursor","$element","addClass","resetCursor","removeClass","duplicate","removeAllSelected","lastParent","lastIndex","getParent","getIndex","remove"],"mappings":"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","file":"zm.js","sourcesContent":["/**\n * Zemit Service\n * @author: <contact@dannycoulombe.com>\n * \n * Store object in the cache\n */\n(function() {\n\tZemit.app.factory('$zm', ['$history', '$file', '$session', '$modal', '$hook', '$i18n', function($history, $file, $session, $modal, $hook, $i18n) {\n\t    \n\t    $hook.add('onBeforeUnload', function() {\n\t    \tvar content = factory.content.get(true, true);\n\t    \t$session.set('content', content);\n\t    });\n\t    \n\t\tvar factory = {\n\t\t    \n\t\t    baseScope: null,\n\t\t\tversion: Zemit.version,\n\t\t\t\n\t\t\tdefaultContainer: {\n\t\t\t\tchilds: []\n\t\t\t},\n\t\t\t\n\t\t\tdefaultWidget: {\n\t\t\t\tstyles: []\n\t\t\t},\n\t\t\t\n\t\t\tsetBaseScope: function(scope) {\n\t\t\t    this.baseScope = scope;\n\t\t\t},\n\t\t\t\n\t\t\tgetBaseScope: function() {\n\t\t\t\treturn this.baseScope;\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Find scope by it's scope ID (scope.$id)\n\t\t\t */\n\t\t\t// getScopeById: function(id) {\n\t\t\t\t\n\t\t\t// \tvar found;\n\t\t\t// \tthis.baseScope.widget.forEachChilds(function(child) {\n\t\t\t// \t\tif(child.getScope().$id === id) {\n\t\t\t// \t\t\tfound = child;\n\t\t\t// \t\t}\n\t\t\t// \t});\n\t\t\t\t\n\t\t\t// \treturn found;\n\t\t\t// },\n\t\t\t\n\t\t\tsession: {\n\t\t\t\t\n\t\t\t\tflushHistory: function() {\n\t\t\t\t\t\n\t\t\t\t\t$history.flush();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tflushAll: function() {\n\t\t\t\t\t\n\t\t\t\t\t$history.flush();\n\t\t\t\t\tfactory.getBaseScope().widget.childs = [];\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tcontent: {\n\t\t\t\t\n\t\t\t\tENCODE: 1,\n\t\t\t\tDECODE: -1,\n\t\t\t\t\n\t\t\t\tparse: function(data, parser) {\n\t\t\t\t\t\n\t\t\t\t\tangular.forEach(data, function(d, k) {\n\t\t\t\t\t\tif(typeof d === 'string') {\n\t\t\t\t\t\t\tdata[k] = parser === factory.content.ENCODE\n\t\t\t\t\t\t\t\t? encodeURIComponent(d)\n\t\t\t\t\t\t\t\t: decodeURIComponent(d);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(d instanceof Object\n\t\t\t\t\t\t|| d instanceof Array) {\n\t\t\t\t\t\t\tdata[k] = factory.content.parse(d);\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Get Zemit data\n\t\t\t\t */\n\t\t\t\tget: function(parser, cleaned) {\n\t\t\t\t\t\n\t\t\t\t\tvar content = $session.get('content');\n\t\t\t\t\tvar data = (parser && this.parse(content)) || content;\n\t\t\t\t\t\n\t\t\t\t\tif(cleaned) {\n\t\t\t\t\t\tdata = angular.fromJson(angular.toJson(data));\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Set Zemit data\n\t\t\t\t */\n\t\t\t\tset: function(data, parser) {\n\t\t\t\t\t\n\t\t\t\t\tif(!(data instanceof Object)) {\n\t\t\t\t\t\tdata = {};\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar content = $session.get('content');\n\t\t\t\t\tcontent.childs = angular.copy((parser && this.parse(data)) || data).childs || [];\n\t\t\t\t\t$session.set('content', content);\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tclear: function() {\n\t\t\t\t\t\n\t\t\t\t\tif(factory.getBaseScope().widget.childs.length === 0) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t$modal.dialog('content_clear', {\n\t\t\t\t\t\tbackdrop: true,\n\t\t\t\t\t\ttitle: $i18n.get('core.di.zm.clearContentTitle'),\n\t\t\t\t\t\tcontent: $i18n.get('core.di.zm.clearContentContent'),\n\t\t\t\t\t\tbuttons: [{\n\t\t\t\t\t\t\tlabel: $i18n.get('core.di.zm.clearContentBtn'),\n\t\t\t\t\t\t\twarning: true,\n\t\t\t\t\t\t\tcallback: (event, modal) => {\n\t\t\t\t\t\t\t\tvar containerWidget = factory.getBaseScope().widget;\n\t\t\t\t\t\t\t\tfactory.action(function() {\n\t\t\t\t\t\t\t\t\tcontainerWidget.childs = [];\n\t\t\t\t\t\t\t\t}, undefined, containerWidget);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tmodal.close();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\tlabel: $i18n.get('core.di.modal.btnCancel'),\n\t\t\t\t\t\t\tdefault: true\n\t\t\t\t\t\t}, ]\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tload: () => {\n\t\t\t\t\t\n\t\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\tvar value = $session.get('config');\n\t\t\t\t\t\tvar data = angular.fromJson(value);\n\t\t\t\t\t\tfactory.data = data || {};\n\t\t\t\t\t\tresolve(factory.data);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\t/**\n\t\t\t * Find a widget by its token\n\t\t\t */\n\t\t\tfindByToken: function(token, container) {\n\t\t\t\t\n\t\t\t\tvar found = false;\n\t\t\t\tcontainer = container === undefined\n\t\t\t\t\t? this.baseScope.widget\n\t\t\t\t\t: container;\n\t\t\t\t\t\n\t\t\t\t// Check if it's the container first\n\t\t\t\tif(container.token === token) {\n\t\t\t\t\treturn container;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Loop through all childs and try to find a match\n\t\t\t\tcontainer.forEachChilds(function(widget) {\n\t\t\t\t\tif(found) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif(widget.token === token) {\n\t\t\t\t\t\tfound = widget;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\treturn found;\n\t\t\t},\n\t\t\t\n\t\t\taction: function(callback, params, widget) {\n\t\t\t\t\n\t\t\t\twidget = this.baseScope.widget;\n\t\t\t\t\n\t\t\t\treturn $history.transaction(widget || this.baseScope.widget, function() {\n\t\t\t\t\treturn callback.apply(null, params);\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\twidget: {\n\t\t\t\t\n\t\t\t\ttotal: 0,\n\t\t\t\ttotalSelected: 0,\n\t\t\t\thoveredWidget: null,\n\t\t\t\tallSelectedSameType: true,\n\t\t\t\t\n\t\t\t\tupdateWidgetStates: function() {\n\t\t\t\t\tthis.allSelectedSameType = this.areAllSelectedSameType();\n\t\t\t\t\tthis.totalSelected = this.countSelected();\n\t\t\t\t\tthis.total = this.count();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcount: function(widget = factory.baseScope.widget) {\n\t\t\t\t\tvar total = 0;\n\t\t\t\t\twidget.forEachChilds(function(widget) {\n\t\t\t\t\t\ttotal++;\n\t\t\t\t\t});\n\t\t\t\t\treturn total;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcountSelected: function() {\n\t\t\t\t\tvar total = 0;\n\t\t\t\t\tthis.forEachSelected(function(widget) {\n\t\t\t\t\t\tif(widget.getScope().isSelected) {\n\t\t\t\t\t\t\ttotal++;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn total;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tareAllSelectedSameType: function() {\n\t\t\t\t\t\n\t\t\t\t\tvar lastType = null;\n\t\t\t\t\tvar allSameType = true;\n\t\t\t\t\tthis.forEachSelected(function(widget) {\n\t\t\t\t\t\tif(allSameType !== false) {\n\t\t\t\t\t\t\tallSameType = lastType === null || widget.type === lastType;\n\t\t\t\t\t\t\tlastType = widget.type;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\treturn allSameType;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tcanEdit: function() {\n\t\t\t\t\t\n\t\t\t\t\tvar hasDefaultAction = true;\n\t\t\t\t\tthis.forEachSelected(function(widget) {\n\t\t\t\t\t\tif(!(widget.getScope().configs.defaultAction instanceof Function)) {\n\t\t\t\t\t\t\thasDefaultAction = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\treturn this.areAllSelectedSameType()\n\t\t\t\t\t\t&& this.countSelected() > 0\n\t\t\t\t\t\t&& hasDefaultAction;\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tedit: function() {\n\t\t\t\t\t\n\t\t\t\t\tif(this.areAllSelectedSameType()) {\n\t\t\t\t\t\tthis.forEachSelected(function(widget) {\n\t\t\t\t\t\t\twidget.getScope().configs.defaultAction(widget.getScope(), widget);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tunselectAll: function() {\n\t\t\t\t\t\n\t\t\t\t\tthis.forEachSelected(function(widget) {\n\t\t\t\t\t\twidget.setSelected(false);\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\tforEachSelected: function(callback) {\n\t\t\t\t\t\n\t\t\t\t\tfactory.baseScope.widget.forEachChilds(function(widget, parent) {\n\t\t\t\t\t\tif(widget.getScope().isSelected) {\n\t\t\t\t\t\t\tcallback(widget);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\thovered: {\n\t\t\t\t\tdata: [],\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Get the latest hovered widget\n\t\t\t\t\t */\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar keys = Object.keys(this.data);\n\t\t\t\t\t\treturn this.data[keys[0]];\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Get the latest hovered widget\n\t\t\t\t\t */\n\t\t\t\t\tgetAll: function() {\n\t\t\t\t\t\treturn this.data;\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Check if widget already hovered\n\t\t\t\t\t */\n\t\t\t\t\tisset: function(widget) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(var i = 0; i < this.data.length; i++) {\n\t\t\t\t\t\t\tif(widget.token === this.data[i].token) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Set the hovered widget in memory\n\t\t\t\t\t */\n\t\t\t\t\tset: function(widget, clearAndTraverse = false) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!this.isset(widget) && !clearAndTraverse) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// If widget was in hovered list, it needs to be unset\n\t\t\t\t\t\t\t// when the widget is removed otherwise it ends-up\n\t\t\t\t\t\t\t// with a corrupted list\n\t\t\t\t\t\t\twidget.getScope().hooks.add('onBeforeRemove', function() {\n\t\t\t\t\t\t\t\tfactory.widget.hovered.unset(widget);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis.data.push(widget);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(clearAndTraverse) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tangular.forEach(this.data, function(widget) {\n\t\t\t\t\t\t\t\tfactory.widget.hovered.unset(widget);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar data = [widget];\n\t\t\t\t\t\t\twidget.forEachParents(function(parent) {\n\t\t\t\t\t\t\t\tdata.unshift(parent);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdata.reverse();\n\t\t\t\t\t\t\tthis.data = data;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Output all hovered tokens to the console\n\t\t\t\t\t\t// var tokens = [];\n\t\t\t\t\t\t// angular.forEach(data, function(d) {\n\t\t\t\t\t\t// \ttokens.push(d.token);\n\t\t\t\t\t\t// });\n\t\t\t\t\t\t// console.log(tokens);\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Unset given widget\n\t\t\t\t\t */\n\t\t\t\t\tunset: function(widget) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor(var i = 0; i < this.data.length; i++) {\n\t\t\t\t\t\t\tif(widget.token === this.data[i].token) {\n\t\t\t\t\t\t\t\tthis.data.splice(i, 1);\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tdrag: {\n\t\t\t\t\tenabled: false,\n\t\t\t\t\tdata: null,\n\t\t\t\t\toriginalWidget: null,\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Get the latest hovered widget\n\t\t\t\t\t */\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn this.data;\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\t/**\n\t\t\t\t\t * Set the hovered widget in memory\n\t\t\t\t\t */\n\t\t\t\t\tset: function(widget, isAlone = false) {\n\t\t\t\t\t\tthis.data = widget;\n\t\t\t\t\t\tthis.enabled = widget !== null;\n\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tif(this.enabled) {\n\t\t\t\t\t\t\tthis.setCursor();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\twidget.getScope().$element.addClass('zm-widget-drag');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(!isAlone) {\n\t\t\t\t\t\t\t\twidget.forEachParents(function(parent) {\n\t\t\t\t\t\t\t\t\tparent.getScope().$element.addClass('zm-widget-drag-parent');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis.originalWidget = widget;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if(this.originalWidget) {\n\t\t\t\t\t\t\tthis.resetCursor();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis.originalWidget.getScope().$element.removeClass('zm-widget-drag');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(!isAlone) {\n\t\t\t\t\t\t\t\tthis.originalWidget.forEachParents(function(parent) {\n\t\t\t\t\t\t\t\t\tparent.getScope().$element.removeClass('zm-widget-drag-parent');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tthis.originalWidget = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\tsetCursor: function(type) {\n\t\t\t\t\t\t\n\t\t\t\t\t\ttype = type === undefined ? 'default' : type;\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.resetCursor();\n\t\t\t\t\t\t//angular.element('html:eq(0)').addClass('zm-cursor-drag-' + type);\n\t\t\t\t\t},\n\t\t\t\t\t\n\t\t\t\t\tresetCursor: function() {\n\t\t\t\t\t\t\n\t\t\t\t\t\t//angular.element('html:eq(0)').removeClass('zm-cursor-drag-default zm-cursor-drag-move zm-cursor-drag-copy');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Duplicate selected widgets\n\t\t\t\t */\n\t\t\t\tduplicate: function() {\n\t\t\t\t\t\n\t\t\t\t\tfactory.widget.forEachSelected(function(widget) {\n\t\t\t\t\t\twidget.duplicate();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tfactory.widget.updateWidgetStates();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t/**\n\t\t\t\t * Remove selected widgets\n\t\t\t\t */\n\t\t\t\tremoveAllSelected: function() {\n\t\t\t\t\t\n\t\t\t\t\tvar lastParent = false;\n\t\t\t\t\tvar lastIndex = 0;\n\t\t\t\t\tfactory.widget.forEachSelected(function(widget) {\n\t\t\t\t\t\tlastParent = widget.getParent();\n\t\t\t\t\t\tlastIndex = widget.getIndex();\n\t\t\t\t\t\twidget.remove();\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif(lastParent && lastParent.childs.length > 0) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(lastIndex > (lastParent.childs.length - 1)) {\n\t\t\t\t\t\t\tlastParent.childs[lastParent.childs.length - 1].setSelected(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tlastParent.childs[lastIndex].setSelected(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(lastParent) {\n\t\t\t\t\t\tlastParent.setSelected(true);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfactory.widget.updateWidgetStates();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\treturn factory;\n\t}]);\n})();"]}