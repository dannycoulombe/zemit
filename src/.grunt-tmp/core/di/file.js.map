{"version":3,"sources":["file.js"],"names":["Zemit","app","factory","namespace","name","toBase64","file","Promise","resolve","reject","reader","FileReader","onload","event","onerror","readAsDataURL","base64toFile","base64","mimeType","data","split","Blob","window","atob","type","encoding","getChecksum","then","string","target","result","index","checksum","length","charCodeAt","downloadAs","fileName","content","encodeURI","link","document","createElement","setAttribute","click","remove","promptFileDialog","callback","accept","input","angular","element","append","onchange","files","drop","init","scope","settings","$e","isSupported","supportedTypes","dataTransfer","items","i","indexOf","parseEvent","completed","read","push","on","preventDefault","removeClass","originalEvent","onComplete","Function","dropEffect","addClass","onDragOver","onDragLeave"],"mappings":"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","file":"file.js","sourcesContent":["/**\n * Zemit File Manager\n * @author: <contact@dannycoulombe.com>\n * \n * Provides tools to drop, preview and upload files.\n */\n(function() {\n\tZemit.app.factory('$file', [function() {\n\t\t\n\t\tvar namespace = this.name;\n\t\t\n\t\tvar factory = {\n\t\t\t\n\t\t\ttoBase64: (file) => {\n\t\t\t\t\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.onload = function(event) {\n\t\t\t\t\t    resolve(event);\n\t\t\t\t\t};\n\t\t\t\t\treader.onerror = reject;\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tbase64toFile: (base64, mimeType) => {\n\t\t\t\t\n\t\t\t\tvar data = base64.split(',')[1];\n\t\t\t\treturn new Blob([window.atob(data)],  {type: mimeType, encoding: 'utf-8'});\n\t\t\t},\n\t\t\t\n\t\t\tgetChecksum: (file) => {\n\t\t\t\t\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\t\n\t\t\t\t\tfactory.toBase64(file).then((event) => {\n\t\t\t\t\t\tvar string = event.target.result;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet index;\n\t\t\t\t\t    let checksum = 0x12345678;\n\t\t\t\t\t\n\t\t\t\t\t    for (index = 0; index < string.length; index++) {\n\t\t\t\t\t        checksum += (string.charCodeAt(index) * (index + 1));\n\t\t\t\t\t    }\n\t\t\t\t\t\n\t\t\t\t\t    resolve(checksum);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tdownloadAs: function(mimeType, fileName, content) {\n\t\t\t\t\n\t\t\t\tvar data = 'data:' + mimeType + 'charset=utf-8,' + content;\n\t\t\t\tdata = encodeURI(data);\n\t\t\n\t\t\t\tvar link = document.createElement('a');\n\t\t\t\tlink.setAttribute('href', data);\n\t\t\t\tlink.setAttribute('download', fileName);\n\t\t\t\tlink.click();\n\t\t\t\tlink.remove();\n\t\t\t},\n\t\t\t\n\t\t\tpromptFileDialog: function(callback, accept) {\n\t\t\t\t\n\t\t\t\tvar input = document.createElement('input');\n\t\t\t\tinput.type = 'file';\n\t\t\t\tinput.accept = accept;\n\t\t\t\tangular.element('body').append(input);\n\t\t\t\tinput.click();\n\t\t\t\t\n\t\t\t\tinput.onchange = function(event) {\n\t\t\t\t\t\n\t\t\t\t\tvar files = event.target.files;\n\t\t\t\t\tvar file = files[0];\n\t\t\t\t\tinput.remove();\n\t\t\t\t\t\n\t\t\t\t\tcallback(file);\n\t\t\t\t};\n\t\t\t},\n\t\t\t\n\t\t\tdrop: {\n\t\t\t\tinit: function(element, scope, settings) {\n\t\t\t\t\n\t\t\t\t\tvar $e = angular.element(element);\n\t\t\t\t\t\n\t\t\t\t\tvar isSupported = function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(!settings.supportedTypes\n\t\t\t\t\t\t|| settings.supportedTypes.length === 0) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar files = event.dataTransfer.items;\n\t\t\t\t\t\tfor (var i = 0, file; file = files[i]; i++) {\n\t\t\t\t\t\t\tif(settings.supportedTypes.indexOf(file.type) === -1) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tvar parseEvent = function(event, callback) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar result = [];\n\t\t\t\t\t\tvar files = event.target.files || event.dataTransfer.files;\n\t\t\t\t\t\tvar completed = 0;\n\t\t\t\t\t\t\n\t\t\t\t\t\tfor (var i = 0, file; file = files[i]; i++) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\t\t\treader.onload = function(read) {\n\t\t\t\t\t\t\t\tcompleted++;\n\t\t\t\t\t\t\t\tresult.push(read);\n\t\t\t\t\t\t\t\tif(completed === files.length) {\n\t\t\t\t\t\t\t\t\tcallback(result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\t\t};\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\t$e.on('drop.' + namespace, function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\n\t\t\t\t\t\t$e.removeClass('zm-file-drop-activate zm-file-drop-invalid');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(isSupported(event.originalEvent)\n\t\t\t\t\t\t&& settings.onComplete instanceof Function) {\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tsettings.onComplete(event, event.originalEvent.dataTransfer.files);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t$e.on('dragover.' + namespace, function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(isSupported(event.originalEvent)) {\n\t\t\t\t\t\t\tevent.originalEvent.dataTransfer.dropEffect = \"copy\";\n\t\t\t\t\t\t\t$e.addClass('zm-file-drop-activate');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif(settings.onDragOver instanceof Function) {\n\t\t\t\t\t\t\t\treturn settings.onDragOver(event);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tevent.originalEvent.dataTransfer.dropEffect = \"none\";\n\t\t\t\t\t\t\t$e.addClass('zm-file-drop-invalid');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t$e.on('dragleave.' + namespace, function(event) {\n\t\t\t\t\t\t\n\t\t\t\t\t\t$e.removeClass('zm-file-drop-activate zm-file-drop-invalid');\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(settings.onDragLeave instanceof Function) {\n\t\t\t\t\t\t\treturn settings.onDragLeave(event);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\t\n\t\treturn factory;\n\t}]);\n})();"]}